<form class="cutin-config-form">

  {{!-- Header Section --}}
  <div class="form-group">
    <label>Cutin Name</label>
    <input type="text" name="cutinName" value="{{cutinName}}" placeholder="Enter cutin name" />
  </div>

  {{!-- Preset Management --}}
  <div class="form-group preset-section">
    <label>Load Preset</label>
    <div class="preset-controls">
      <select id="preset-selector">
        <option value="">-- Select a Preset --</option>
        {{#each presets}}
        <option value="{{id}}">{{name}}{{#if isDefault}} (Default){{/if}}</option>
        {{/each}}
      </select>
      <button type="button" data-action="savePreset"><i class="fas fa-save"></i> Save as Preset</button>
    </div>
  </div>

  <hr />

  {{!-- Character Image Section --}}
  <div class="form-group">
    <label>Character Image</label>
    <div class="image-select">
      {{#if config.characterImage}}
      <img src="{{config.characterImage}}" alt="Character Preview" class="image-preview" />
      {{else}}
      <div class="image-placeholder">No image selected</div>
      {{/if}}
      <button type="button" data-action="selectImage"><i class="fas fa-image"></i> Select Image</button>
    </div>
  </div>

  {{!-- Image Positioning --}}
  <div class="form-group">
    <label>Image Horizontal Align</label>
    <select name="imageHorizontalAlign">
      <option value="right" {{#if (eq config.imageHorizontalAlign "right")}}selected{{/if}}>Right</option>
      <option value="left" {{#if (eq config.imageHorizontalAlign "left")}}selected{{/if}}>Left</option>
      <option value="center" {{#if (eq config.imageHorizontalAlign "center")}}selected{{/if}}>Center</option>
    </select>
  </div>

  {{!-- Backdrop Style --}}
  <div class="form-group">
    <label>Backdrop Style</label>
    <select name="backdropStyle" id="backdropStyle">
      {{#each backdropStyles}}
      <option value="{{value}}" data-colors="{{colors}}" {{#if (eq value ../config.backdropStyle)}}selected{{/if}}>{{label}}</option>
      {{/each}}
    </select>
  </div>

  {{!-- Color Customization (shown only for backdrops that support colors) --}}
  {{#unless (eq backdropColors "none")}}
  <div class="form-group">
    <label class="checkbox-label">
      <input type="checkbox" id="customizeColors" {{#if config.backdropPrimaryColor}}checked{{/if}} />
      Customize Backdrop Colors
    </label>
  </div>

  <div class="color-customization" style="display: {{#if config.backdropPrimaryColor}}block{{else}}none{{/if}}; margin-left: 1.5em;">
    <div class="form-row">
      {{!-- Primary color (shown for 'primary' and 'both') --}}
      <div class="form-group">
        <label>Primary Color</label>
        <input type="color" name="backdropPrimaryColor" value="{{#if config.backdropPrimaryColor}}{{config.backdropPrimaryColor}}{{else}}#cc0000{{/if}}" />
      </div>
      {{!-- Secondary color (shown only for 'both') --}}
      {{#if (eq backdropColors "both")}}
      <div class="form-group">
        <label>Secondary Color</label>
        <input type="color" name="backdropSecondaryColor" value="{{#if config.backdropSecondaryColor}}{{config.backdropSecondaryColor}}{{else}}#ff3333{{/if}}" />
      </div>
      {{/if}}
    </div>
    <button type="button" id="resetColors" style="font-size: 11px; padding: 4px 8px;">
      <i class="fas fa-undo"></i> Reset to Defaults
    </button>
  </div>
  {{/unless}}

  {{!-- Text Layers --}}
  <div class="form-group">
    <label>Text Overlays</label>
    <div class="text-layers">
      {{#each config.textLayers}}
      <div class="text-layer {{#unless isExpanded}}collapsed{{/unless}}" data-index="{{index}}" draggable="true">
        <div class="text-layer-header">
          <i class="fas fa-grip-vertical drag-handle"></i>
          <i class="fas fa-chevron-down collapse-icon"></i>
          <span>Text Layer {{index}}</span>
          <button type="button" data-action="removeTextLayer" data-index="{{index}}">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="text-layer-fields {{#unless isExpanded}}collapsed{{/unless}}">
          <div class="text-layer-field">
            <label>Text</label>
            <textarea name="textLayer.{{index}}.text" placeholder="Enter text..." rows="2">{{text}}</textarea>
          </div>
          <div class="text-layer-field-row">
            <div class="text-layer-field">
              <label>Font</label>
              <select name="textLayer.{{index}}.font">
                {{#each ../fonts}}
                <option value="{{this}}" {{#if (eq this ../font)}}selected{{/if}}>{{this}}</option>
                {{/each}}
              </select>
            </div>
            <div class="text-layer-field">
              <label>Size</label>
              <input type="number" name="textLayer.{{index}}.size" value="{{size}}" min="12" max="120" />
            </div>
            <div class="text-layer-field">
              <label>Color</label>
              <input type="color" name="textLayer.{{index}}.color" value="{{color}}" />
            </div>
          </div>
          <div class="text-layer-field-row">
            <div class="text-layer-field">
              <label>Line Height</label>
              <input type="number" name="textLayer.{{index}}.lineHeight" value="{{#if lineHeight}}{{lineHeight}}{{else}}1.0{{/if}}" min="0.5" max="5.0" step="0.1" />
            </div>
            <div class="text-layer-field">
              <label>Max Width (%)</label>
              <input type="number" name="textLayer.{{index}}.maxWidth" value="{{#if maxWidth}}{{maxWidth}}{{else}}80{{/if}}" min="10" max="100" step="5" />
            </div>
          </div>
          <div class="text-layer-field">
            <label>Position</label>
            <select name="textLayer.{{index}}.position">
              {{#each ../textPositions}}
              <option value="{{value}}" {{#if (eq value ../position)}}selected{{/if}}>{{label}}</option>
              {{/each}}
            </select>
          </div>
          <div class="text-layer-field-row">
            <div class="text-layer-field">
              <label>Offset X (px)</label>
              <input type="number" name="textLayer.{{index}}.offsetX" value="{{#if offsetX}}{{offsetX}}{{else}}0{{/if}}" step="10" />
            </div>
            <div class="text-layer-field">
              <label>Offset Y (px)</label>
              <input type="number" name="textLayer.{{index}}.offsetY" value="{{#if offsetY}}{{offsetY}}{{else}}0{{/if}}" step="10" />
            </div>
          </div>
          <div class="text-layer-field-row">
            <label class="checkbox-label">
              <input type="checkbox" name="textLayer.{{index}}.hasBackground" {{#if hasBackground}}checked{{/if}} />
              Background
            </label>
            {{#if hasBackground}}
            <div class="text-layer-field">
              <label>Background Color</label>
              <input type="color" name="textLayer.{{index}}.backgroundColor" value="{{#if backgroundColor}}{{backgroundColor}}{{else}}#000000{{/if}}" />
            </div>
            {{/if}}
          </div>
        </div>
      </div>
      {{/each}}
      <button type="button" data-action="addTextLayer" class="add-text-btn">
        <i class="fas fa-plus"></i> Add Text Layer
      </button>
    </div>
  </div>

  {{!-- Animation Settings --}}
  <div class="form-group">
    <label>Animation Style</label>
    <select name="animationStyle">
      {{#each animationStyles}}
      <option value="{{value}}" {{#if (eq value ../config.animationStyle)}}selected{{/if}}>{{label}}</option>
      {{/each}}
    </select>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label>Entrance Duration (ms)</label>
      <input type="number" name="duration" value="{{config.duration}}" min="100" max="3000" step="100" />
    </div>
    <div class="form-group">
      <label>Exit Duration (ms)</label>
      <input type="number" name="exitDuration" value="{{config.exitDuration}}" min="100" max="2000" step="100" />
    </div>
  </div>

  {{!-- Dismissal Settings --}}
  <div class="form-group">
    <label>Dismissal Mode</label>
    <select name="dismissalMode">
      {{#each dismissalModes}}
      <option value="{{value}}" {{#if (eq value ../config.dismissalMode)}}selected{{/if}}>{{label}}</option>
      {{/each}}
    </select>
  </div>

  <div class="form-group">
    <label>Auto-Dismiss Delay (ms)</label>
    <input type="number" name="autoDismissDelay" value="{{config.autoDismissDelay}}" min="1000" max="10000" step="500" />
    <small>Used when dismissal mode is set to Auto-Dismiss</small>
  </div>

  {{!-- Sound Section (only for gm-dismiss and auto-dismiss modes) --}}
  {{#if showSoundSection}}
  <div class="form-group">
    <label>Sound</label>
    <div class="sound-drop-zone">
      {{#if config.soundName}}
      <div class="sound-info">
        <i class="fas fa-music"></i>
        <span class="sound-name">{{config.soundName}}</span>
        <button type="button" class="sound-clear-btn"><i class="fas fa-times"></i></button>
      </div>
      {{else}}
      <div class="sound-placeholder">
        <i class="fas fa-music"></i>
        <span>Drag a sound from a Playlist</span>
      </div>
      {{/if}}
      <input type="hidden" name="soundUuid" value="{{config.soundUuid}}" />
    </div>
    <div class="sound-controls">
      <div class="sound-control">
        <label>Volume</label>
        <div class="sound-volume-row">
          <input type="range" name="soundVolume" value="{{config.soundVolume}}" min="0" max="1" step="0.05" />
          <span class="sound-volume-display">{{soundVolumePercent}}%</span>
        </div>
      </div>
      <div class="sound-control">
        <label class="checkbox-label">
          <input type="checkbox" name="soundLoop" {{#if config.soundLoop}}checked{{/if}} />
          Loop Sound
        </label>
      </div>
    </div>
    <small>Currently playing playlists will pause while the cut-in is active</small>
  </div>
  {{/if}}

  {{!-- Audience Selection --}}
  <div class="form-group">
    <label>Audience</label>
    <div class="audience-select">
      <label class="radio-label">
        <input type="radio" name="audienceMode" value="all" {{#if (eq config.audience "all")}}checked{{/if}} id="audience-all" />
        All Players
      </label>
      <label class="radio-label">
        <input type="radio" name="audienceMode" value="specific" {{#unless (eq config.audience "all")}}checked{{/unless}} id="audience-specific" />
        Specific Players
      </label>
      <div id="player-selection" style="margin-top: 0.5em; padding-left: 1.5em; display: {{#if (eq config.audience "all")}}none{{else}}block{{/if}};">
        {{#each players}}
        <label style="display: block; margin: 0.3em 0;">
          <input type="checkbox" name="player-{{id}}" value="{{id}}" {{#if selected}}checked{{/if}} />
          {{name}}
        </label>
        {{/each}}
      </div>
    </div>
  </div>

  <hr />

  {{!-- Action Buttons --}}
  <div class="form-actions">
    <button type="button" data-action="preview" class="preview-btn">
      <i class="fas fa-eye"></i> Preview
    </button>
    <button type="button" data-action="save" class="save-btn">
      <i class="fas fa-check"></i> {{#if isEditing}}Update{{else}}Save to Deck{{/if}}
    </button>
    <button type="button" data-action="close" class="cancel-btn">
      <i class="fas fa-times"></i> Cancel
    </button>
  </div>

</form>
